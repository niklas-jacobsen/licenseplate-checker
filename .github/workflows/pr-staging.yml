name: 'Run Linter and Tests on Pull Request to Staging'

on:
  pull_request:
    branches:
      - 'staging'

permissions:
  contents: read

jobs:
  lint-and-test:
    runs-on: 'ubuntu-latest'

    steps:
      - name: 'Checkout code'
        uses: 'actions/checkout@v4'

      - name: 'Set up Bun'
        uses: 'oven-sh/setup-bun@v2'
        with:
          bun-version: '1.3.9'

      - name: 'Install dependencies'
        run: 'bun install'

      - name: 'Run Linter'
        run: 'bun lint'
        continue-on-error: false

      - name: 'Run Tests'
        run: 'bun test'
        continue-on-error: false
        env:
          DATABASE_URL: 'postgresql://test:test@localhost:5432/test'
          ALLOWED_ORIGINS: 'http://localhost:3000'
          JWT_SECRET: 'ci-test-secret'
